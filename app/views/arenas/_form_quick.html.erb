<% content_for :head do %>
  <meta name="mapbox-token" content="<%= Rails.configuration.x.mapbox_token %>">
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
<% end %>

<div data-controller="arena-location" class="space-y-4">
  <%= form_with model: arena, url: arenas_path, data: { turbo: true }, class: "space-y-4" do |f| %>
    
    <!-- Nombre de la arena -->
    <div class="mb-3">
      <%= f.label :name, "Nombre de la arena", class: "form-label fw-bold" %>
      <%= f.text_field :name, required: true, class: "form-control", placeholder: "Ej: Arena Deportiva Central" %>
    </div>

                <!-- Paso 1: País -->
            <div data-arena-location-target="step1" class="mb-4">
              <h6 class="mb-3">Paso 1: País</h6>
              <div class="mb-3">
                <%= f.label :country, "País", class: "form-label" %>
                <%= f.text_field :country, data: { arena_location_target: "country" }, 
                    placeholder: "Colombia", class: "form-control" %>
              </div>
              <button type="button" class="btn btn-primary btn-sm" data-action="click->arena-location#nextFromCountry">
                Siguiente
              </button>
            </div>

            <!-- Paso 2: Ciudad -->
            <div data-arena-location-target="step2" class="mb-4 d-none">
              <h6 class="mb-3">Paso 2: Ciudad</h6>
              <div class="mb-3">
                <%= f.label :city, "Ciudad", class: "form-label" %>
                <%= f.text_field :city, data: { arena_location_target: "city" }, 
                    placeholder: "Bogotá", class: "form-control" %>
              </div>
              <div class="d-flex gap-2">
                <button type="button" class="btn btn-outline-secondary btn-sm" data-action="click->arena-location#backTo1">
                  Atrás
                </button>
                <button type="button" class="btn btn-primary btn-sm" data-action="click->arena-location#nextFromCity">
                  Siguiente
                </button>
              </div>
            </div>

            <!-- Paso 3: Dirección + mapa -->
            <div data-arena-location-target="step3" class="mb-4 d-none">
              <h6 class="mb-3">Paso 3: Dirección</h6>
              
              <div class="mb-3">
                <%= f.label :address, "Dirección", class: "form-label" %>
                <%= f.text_field :address, data: { arena_location_target: "address", action: "input->arena-location#addressChanged" }, 
                    placeholder: "Cra 7 # 10-20", class: "form-control" %>
                <div class="form-text small">Escribe la dirección y se ubicará automáticamente</div>
              </div>

              <div class="mb-3">
                <%= f.label :neighborhood, "Barrio (opcional)", class: "form-label" %>
                <%= f.text_field :neighborhood, data: { arena_location_target: "neighborhood" }, 
                    placeholder: "La Candelaria", class: "form-control" %>
              </div>

              <!-- Mapa más pequeño para modal -->
              <div class="mb-3">
                <label class="form-label">Ubicación</label>
                <div class="border rounded mapbox-pane-small" data-arena-location-target="map"></div>
                <div class="form-text small">Arrastra el marcador para ajustar</div>
              </div>

      <!-- Campos ocultos para coordenadas -->
      <%= f.hidden_field :latitude, data: { arena_location_target: "lat" } %>
      <%= f.hidden_field :longitude, data: { arena_location_target: "lng" } %>

      <!-- 1-3 fotos opcionales para modal rápido -->
      <div class="mb-3">
        <%= f.label :photos, "Fotos (opcional, máx. 3)", class: "form-label" %>
        <%= f.file_field :photos, multiple: true, accept: "image/*", class: "form-control" %>
        <div class="form-text small">Máximo 3 fotos para creación rápida</div>
      </div>

                    <div class="d-flex gap-2">
                <button type="button" class="btn btn-outline-secondary btn-sm" data-action="click->arena-location#backTo2">
                  Atrás
                </button>
                <%= f.submit "Crear Arena", class: "btn btn-success btn-sm" %>
              </div>
    </div>
  <% end %>
</div>
