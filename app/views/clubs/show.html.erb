
<% if @club.avatar.attached? %>
  <img src="<%= url_for(@club.avatar) %>" alt="Logo de <%= @club.name %>" class="img-fluid rounded">
<% else %>
  <p>No hay imagen de club.</p>
<% end %>
  <h1><%= @club.name %></h1>
  <p>Admin: <%= @club.king_admin&.user&.firstname %> <%= @club.king_admin&.user&.lastname %> (<%= @club.king_admin&.user&.slug %>)</p>
  <%= link_to 'Edit', edit_club_path(@club) %> |
  <%= link_to 'Back', clubs_path %>


  <h1><%= @club.name %></h1>
<p><%= @club.description %></p> 
<% membership = current_user.memberships.find_by(joinable: @club) %>

<% if membership&.approved? %>
  <!-- Si ya estÃ¡ aprobado, no mostramos nada -->
<% elsif membership&.pending? %>
  <button class="btn btn-warning" disabled>Pending Approval</button>
<% else %>
  <button id="join-club-btn" class="btn btn-primary" data-club-id="<%= @club.id %>">
    Join Club
  </button>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const joinBtn = document.getElementById("join-club-btn");

    if (joinBtn) {
      joinBtn.addEventListener("click", function() {
        const clubId = joinBtn.dataset.clubId;
        
        fetch(`/clubs/${clubId}/memberships`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-Token": document.querySelector("meta[name='csrf-token']").content
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === "pending") {
            joinBtn.textContent = "Pending Approval";
            joinBtn.classList.remove("btn-primary");
            joinBtn.classList.add("btn-warning");
            joinBtn.disabled = true;
          }
        })
        .catch(error => console.error("Error:", error));
      });
    }
  });
</script>