<h1>Convocar jugadores del equipo <%= @team.name %></h1>

<% if @members.present? %>
  <%= button_to 'Convocar a todos',
        send_callups_to_all_duels_path(team_id: @team.id, user_ids: @users.map(&:id)),
        method: :post,
        form: { data: { turbo_stream: true } },
        class: "btn btn-primary mb-3" %>
<% end %>

<ul>
  <% @users.each do |user| %>
    <li id="user_<%= user.id %>">
      <%= user.slug %>

      <% callup = @callups.find { |c| c.user_id == user.id } %>

      <% if callup.present? %>
        <% if callup.accepted? %>
          <span class="badge bg-success">✅ Aceptado</span>
        <% elsif callup.rejected? %>
          <span class="badge bg-danger">❌ Rechazado</span>
        <% else %>
          <span class="badge bg-warning text-dark">⏳ Pendiente</span>
        <% end %>
      <% else %>
        <%= button_to 'Convocar',
              send_callup_duels_path(team_id: @team.id, user_id: user.id, duel_id: params[:duel_id]),
              method: :post,
              form: { data: { turbo_stream: true } },
              class: "btn btn-outline-primary btn-sm" %>
      <% end %>
    </li>
  <% end %>
</ul>

<% if @callups.any? %>
  <%= link_to "Continuar a Aceptar Responsabilidad",
        responsibility_duels_path(team_id: @team.id),
        class: "btn btn-success mt-4" %>
<% else %>
  <%= link_to "Continuar a Aceptar Responsabilidad", "#",
        class: "btn btn-secondary disabled", disabled: true %>
<% end %>
