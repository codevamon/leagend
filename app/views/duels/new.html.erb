<div class="container mt-4" data-controller="modal duel-form">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <!-- Header -->
      <div class="text-center mb-4">
        <h2 class="fw-bold text-primary">
          <i class="fas fa-trophy me-2"></i>Crear Nuevo Duelo
        </h2>
        <p class="text-muted">Configura tu duelo en un solo paso</p>
      </div>

      <!-- Formulario principal -->
      <div class="card shadow-sm border-0">
        <div class="card-body p-4">
          <%= form_with model: @duel, local: true, class: "needs-validation", novalidate: true, 
              data: { duel_form_target: "form" } do |f| %>
            
            <!-- Fecha y Hora -->
            <div class="row mb-4">
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="fas fa-calendar me-2 text-success"></i>Fecha y Hora
                </label>
                <%= f.datetime_local_field :starts_at, 
                    class: "form-control", 
                    required: true,
                    min: Time.current.strftime("%Y-%m-%dT%H:%M"),
                    data: { duel_form_target: "startsAt" } %>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="fas fa-stopwatch me-2 text-warning"></i>Duración (horas)
                </label>
                <%= f.number_field :duration, 
                    class: "form-control", 
                    value: 2,
                    min: 1, max: 6,
                    required: true,
                    data: { duel_form_target: "duration" } %>
              </div>
            </div>

            <!-- Tipo de Duelo -->
            <div class="mb-4">
              <label class="form-label fw-semibold">
                <i class="fas fa-gamepad me-2 text-info"></i>Tipo de Duelo
              </label>
              <%= f.select :duel_type, 
                  Duel.duel_types.keys.map { |t| [t.titleize, t] },
                  { selected: 'friendly' },
                  { class: "form-select", required: true } %>
            </div>

            <!-- Arena (Opcional) -->
            <div class="mb-4">
              <label class="form-label fw-semibold">
                <i class="fas fa-map-marker-alt me-2 text-danger"></i>Arena (Opcional)
              </label>
              <div class="arena-select-container mb-2">
                <%= turbo_frame_tag "arena_select" do %>
                  <%= render "arenas/arena_select", arenas: @arenas, selected_id: @duel&.arena_id %>
                <% end %>
                <%= link_to "Crear Arena",
                    new_arena_path(quick: true),
                    data: { 
                      turbo_frame: "modal",
                      action: "click->modal#open"
                    },
                    class: "btn btn-outline-primary",
                    aria_label: "Crear nueva arena" %>
              </div>
              <small class="text-muted">
                <i class="fas fa-info-circle me-1"></i>
                Si no seleccionas arena, podrás buscar rivales después
              </small>
            </div>

            <!-- Opciones adicionales -->
            <div class="mb-4">
              <div class="form-check">
                <%= check_box_tag :assign_referee, "1", false, class: "form-check-input" %>
                <label class="form-check-label" for="assign_referee">
                  <i class="fas fa-user-tie me-2"></i>Asignar árbitro automáticamente
                </label>
              </div>
            </div>

            <!-- Botones -->
            <div class="d-grid gap-2">
              <%= f.submit "Crear Duelo", class: "btn btn-primary btn-lg btn-create-duel" %>
              <%= link_to "Cancelar", duels_path, class: "btn btn-outline-secondary" %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Información adicional -->
      <div class="card mt-4 border-0 info-card">
        <div class="card-body">
          <h6 class="fw-semibold mb-3">
            <i class="fas fa-lightbulb me-2 text-warning"></i>¿Cómo funciona?
          </h6>
          <ul class="list-unstyled mb-0">
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              <strong>Crea el duelo:</strong> Configura fecha, hora y tipo
            </li>
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              <strong>Equipo automático:</strong> Se crea un equipo temporal automáticamente
            </li>
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              <strong>Convoca jugadores:</strong> Invita a tu equipo desde el panel
            </li>
            <li class="mb-0">
              <i class="fas fa-check text-success me-2"></i>
              <strong>¡Juega!</strong> Inicia el duelo cuando esté todo listo
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Contenedor para mensajes flash -->
  <div id="flash"></div>
  
  <!-- Turbo Frame para modal - Configurado para funcionar con arena_location_controller -->
  <%= turbo_frame_tag "modal" %>
</div>

 