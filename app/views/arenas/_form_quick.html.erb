<% context_id = "arena-quick" %>
<%= form_with(model: arena, local: true, html: { class: "arena-form" }) do |f| %>
  <div data-controller="arena-location" 
       data-arena-location-editable-value="true"
       data-arena-location-center-lat-value="<%= arena.latitude || 4.7110 %>"
       data-arena-location-center-lng-value="<%= arena.longitude || -74.0721 %>"
       data-mapbox-token="<%= Rails.application.credentials.dig(:mapbox, :public_token) %>">
    
    <% if arena.errors.any? %>
      <div class="alert alert-danger">
        <h6><%= pluralize(arena.errors.count, "error") %> impidieron guardar esta arena:</h6>
        <ul class="mb-0">
          <% arena.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <%= f.label :name, "Nombre de la Arena", class: "form-label fw-semibold" %>
          <%= f.text_field :name, class: "form-control", required: true %>
        </div>

        <div class="mb-3">
          <%= f.label :country, "País", class: "form-label fw-semibold" %>
          <%= f.text_field :country, class: "form-control", 
              data: { 
                arena_location_target: "country",
                action: "input->arena-location#onCountryInput"
              } %>
          <!-- Contenedor de sugerencias de autocomplete para países -->
          <div id="country-suggestions-<%= context_id %>" class="list-group position-absolute w-100" style="z-index:1000; display: none; max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);"></div>
          <!-- Contenedor para geocoder de países -->
          <div data-arena-location-target="geocoderCountry" class="geocoder-container"></div>
        </div>

        <div class="mb-3">
          <%= f.label :city, "Ciudad", class: "form-label fw-semibold" %>
          <%= f.text_field :city, class: "form-control", 
              data: { 
                arena_location_target: "city",
                action: "input->arena-location#onCityInput"
              } %>
          <!-- Contenedor de sugerencias de autocomplete para ciudades -->
          <div id="city-suggestions-<%= context_id %>" class="list-group position-absolute w-100" style="z-index:1000; display: none; max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);"></div>
          <!-- Contenedor para geocoder de ciudades -->
          <div data-arena-location-target="geocoderCity" class="geocoder-container"></div>
        </div>

        <div class="mb-3">
          <%= f.label :address, "Dirección", class: "form-label fw-semibold" %>
          <%= f.text_field :address, class: "form-control", 
              data: { 
                arena_location_target: "address",
                action: "input->arena-location#onAddressInput"
              } %>
          <!-- Contenedor de sugerencias de autocomplete para direcciones -->
          <div id="address-suggestions-<%= context_id %>" class="list-group position-absolute w-100" style="z-index:1000; display: none; max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);"></div>
          <!-- Contenedor para geocoder de direcciones -->
          <div data-arena-location-target="geocoderAddress" class="geocoder-container"></div>
        </div>

        <!-- Campos hidden para lat/lng -->
        <%= f.hidden_field :latitude, data: { arena_location_target: "latitude" } %>
        <%= f.hidden_field :longitude, data: { arena_location_target: "longitude" } %>

        <div class="mb-3">
          <%= f.label :neighborhood, "Barrio (opcional)", class: "form-label fw-semibold" %>
          <%= f.text_field :neighborhood, class: "form-control" %>
        </div>
      </div>

      <div class="col-md-6">
        <div class="arena-map-container">
          <div 
            id="arena-map-<%= context_id %>" 
            class="mapbox-container" 
            data-arena-location-target="map">
          </div>
        </div>
        
        <small class="text-muted d-block mt-2">
          <i class="fas fa-info-circle me-1"></i>
          Arrastra el marcador o usa las sugerencias para establecer la ubicación
        </small>
      </div>
    </div>

    <div class="d-flex gap-2 justify-content-end mt-4">
      <button type="button" class="btn btn-outline-secondary" data-action="click->modal#close">
        <i class="fas fa-times me-1"></i>Cancelar
      </button>
      <%= f.submit "Crear Arena", class: "btn btn-primary" %>
    </div>
  </div>
<% end %>
