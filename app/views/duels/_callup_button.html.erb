<%# Partial para el botón de convocatoria %>
<% existing_callup = team.callups.find_by(user: player, duel: duel) %>
<% is_captain = player == team.captain %>

<div id="callup_button_<%= player.id %>">
  <% if existing_callup.nil? %>
    <%# No convocado - mostrar botón para convocar %>
    <% if is_captain %>
      <%# Si es el capitán, usar la acción de autoconvocatoria %>
      <%= button_to self_callup_captain_duel_path(duel), 
          method: :post, 
          class: "btn btn-warning btn-sm",
          data: { turbo: true } do %>
        <i class="fas fa-crown me-1"></i>Autoconvocarme
      <% end %>
    <% else %>
      <%# Si no es el capitán, usar la acción normal de convocatoria %>
      <%= button_to callup_player_duel_path(duel, user_id: player.id), 
          method: :post, 
          class: "btn btn-primary btn-sm",
          data: { turbo: true } do %>
        <i class="fas fa-plus me-1"></i>Convocar
      <% end %>
    <% end %>
  <% elsif existing_callup.pending? %>
    <%# Pendiente - mostrar estado pendiente %>
    <button class="btn btn-warning btn-sm" type="button" disabled>
      <i class="fas fa-clock me-1"></i>Pendiente
    </button>
  <% elsif existing_callup.accepted? %>
    <%# Confirmado - mostrar estado confirmado %>
    <button class="btn btn-success btn-sm" type="button" disabled>
      <i class="fas fa-check me-1"></i>Confirmado
    </button>
  <% elsif existing_callup.rejected? %>
    <%# Rechazado - mostrar botón para convocar nuevamente %>
    <% if is_captain %>
      <%= button_to self_callup_captain_duel_path(duel), 
          method: :post, 
          class: "btn btn-warning btn-sm",
          data: { turbo: true } do %>
        <i class="fas fa-crown me-1"></i>Autoconvocarme
      <% end %>
    <% else %>
      <%= button_to callup_player_duel_path(duel, user_id: player.id), 
          method: :post, 
          class: "btn btn-primary btn-sm",
          data: { turbo: true } do %>
        <i class="fas fa-redo me-1"></i>Convocar Nuevamente
      <% end %>
    <% end %>
  <% end %>
</div> 